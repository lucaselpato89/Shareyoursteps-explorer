const e=window?.shareYourSteps?.websocket_url;let t;function n(e=1,t=[]){return fetch(`${window.shareYourSteps.api_url}routes?page=${e}`,{headers:{"X-WP-Nonce":window.shareYourSteps.nonce}}).then(e=>e.json()).then(o=>{const a=t.concat(o.routes||[]);return e<o.total_pages?n(e+1,a):{routes:a,total:o.total,total_pages:o.total_pages}})}function o(){setInterval(()=>{n().then(e=>document.dispatchEvent(new CustomEvent("liveTick",{detail:e}))).catch(()=>{}),fetch(window.shareYourSteps.api_url+"chat",{headers:{"X-WP-Nonce":window.shareYourSteps.nonce}}).then(e=>e.json()).then(e=>document.dispatchEvent(new CustomEvent("chatTick",{detail:e}))).catch(()=>{})},5e3)}export function sendLiveTick(e){const n=JSON.stringify({type:"liveTick",payload:e});t&&t.readyState===WebSocket.OPEN?t.send(n):fetch(window.shareYourSteps.api_url+"save-route",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.shareYourSteps.nonce},body:JSON.stringify(e)}).catch(()=>{})}export function sendChatTick(e){const n=JSON.stringify({type:"chatTick",payload:e});t&&t.readyState===WebSocket.OPEN?t.send(n):fetch(window.shareYourSteps.api_url+"chat",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.shareYourSteps.nonce},body:JSON.stringify(e)}).catch(()=>{})}e&&"WebSocket"in window?(t=new WebSocket(e),t.addEventListener("message",e=>{try{const t=JSON.parse(e.data);document.dispatchEvent(new CustomEvent(t.type,{detail:t.payload}))}catch(e){console.error(e)}}),t.addEventListener("close",o),t.addEventListener("error",o)):o();